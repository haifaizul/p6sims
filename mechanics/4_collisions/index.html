<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Collisions & Momentum - p6sims</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../../style.css">
    <style>
        /* Simulation Specific Styles */
        :root {
            --panel-bg-color: #f8fafc;
            --slider-track-color: #e2e8f0;
            --code-bg-color: #f1f5f9;
            --object-a-color: #3b82f6;
            --object-b-color: #ef4444;
        }

        body {
            display: block;
            padding: 0;
            background-color: var(--bg-color);
        }

        .simulation-wrapper {
            max-width: 900px;
            margin: 40px auto;
            background: var(--surface-color);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            padding: 30px;
            border: 1px solid var(--border-color);
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2rem;
        }

        .controls-panel {
            margin-bottom: 24px;
            padding: 20px;
            background-color: var(--panel-bg-color);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
        }

        .control-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .control-group:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
            grid-template-columns: 1fr;
        }

        .control-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-item label {
            min-width: 80px;
            font-weight: 500;
            color: var(--text-muted);
        }

        .object-title {
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 0.9rem;
            text-transform: uppercase;
        }

        .title-a {
            color: var(--object-a-color);
        }

        .title-b {
            color: var(--object-b-color);
        }

        input[type="range"] {
            flex-grow: 1;
            cursor: pointer;
            height: 6px;
            background: var(--slider-track-color);
            border-radius: 4px;
            appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 16px;
            height: 16px;
            background: var(--primary-color);
            border-radius: 50%;
            cursor: pointer;
        }

        .value-display {
            min-width: 60px;
            text-align: right;
            font-family: monospace;
            font-weight: 600;
            color: var(--primary-color);
        }

        .sim-button {
            padding: 10px 24px;
            background-color: var(--text-main);
            color: white;
            border: none;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin: 0 5px;
        }

        .sim-button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .sim-button.secondary {
            background-color: transparent;
            color: var(--text-main);
            border: 1px solid var(--border-color);
        }

        canvas {
            border: 1px solid var(--border-color);
            background-color: #ffffff;
            display: block;
            width: 100%;
            height: 300px;
            border-radius: var(--radius-md);
            margin-bottom: 24px;
        }

        .info-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            padding: 15px;
            background: #eff6ff;
            border-radius: var(--radius-md);
            margin-bottom: 24px;
            border: 1px solid #dbeafe;
        }

        .info-item {
            text-align: center;
        }

        .info-item strong {
            display: block;
            font-size: 0.75rem;
            text-transform: uppercase;
            color: var(--text-muted);
            margin-bottom: 4px;
        }

        .info-item span {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        /* Notes Section */
        .notes-section {
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            overflow: hidden;
            background: var(--bg-color);
        }

        .notes-header {
            padding: 16px 20px;
            background: white;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .notes-header h3 {
            margin: 0;
            font-size: 1.1rem;
        }

        .notes-content {
            padding: 20px;
            display: none;
        }

        .notes-section.notes-open .notes-content {
            display: block;
        }

        .note-block {
            margin-bottom: 20px;
        }

        .note-block h4 {
            color: var(--text-main);
            margin-bottom: 8px;
        }

        .note-block p,
        .note-block li {
            color: var(--text-muted);
            font-size: 0.95rem;
        }

        code {
            background: var(--code-bg-color);
            padding: 2px 6px;
            border-radius: 4px;
            color: var(--primary-color);
            font-size: 0.9em;
        }

        .lang-button {
            padding: 4px 10px;
            font-size: 0.75rem;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            cursor: pointer;
            color: var(--text-secondary);
        }
    </style>
</head>

<body>

    <header class="site-header">
        <div class="container">
            <a href="../../index.html" class="logo">p6sims</a>
            <nav class="nav-links">
                <a href="../../index.html#simulations">All Simulations</a>
                <a href="../../index.html#about">About</a>
            </nav>
        </div>
    </header>

    <main class="container">
        <div class="simulation-wrapper">
            <div style="margin-bottom: 20px;">
                <a href="../../mechanics.html" style="color: var(--text-muted); font-size: 0.9rem;">&larr; Back to
                    Mechanics</a>
            </div>

            <h1>Collisions & Momentum</h1>

            <div class="controls-panel">
                <div class="control-group">
                    <div>
                        <div class="object-title title-a">Object A</div>
                        <div class="control-item">
                            <label>Mass:</label>
                            <input type="range" id="massA" min="1" max="10" value="2">
                            <span id="massAValue" class="value-display">2 kg</span>
                        </div>
                        <div class="control-item">
                            <label>Velocity:</label>
                            <input type="range" id="velA" min="0" max="10" value="5">
                            <span id="velAValue" class="value-display">5 m/s</span>
                        </div>
                    </div>
                    <div>
                        <div class="object-title title-b">Object B</div>
                        <div class="control-item">
                            <label>Mass:</label>
                            <input type="range" id="massB" min="1" max="10" value="5">
                            <span id="massBValue" class="value-display">5 kg</span>
                        </div>
                        <div class="control-item">
                            <label>Velocity:</label>
                            <input type="range" id="velB" min="-10" max="0" value="0">
                            <span id="velBValue" class="value-display">0 m/s</span>
                        </div>
                    </div>
                </div>
                <div class="control-group">
                    <div class="control-item">
                        <label>Elasticity (e):</label>
                        <input type="range" id="elasticity" min="0" max="1" step="0.1" value="1">
                        <span id="elasticityValue" class="value-display">1.0</span>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 10px;">
                    <button id="startButton" class="sim-button">Start</button>
                    <button id="resetButton" class="sim-button secondary">Reset</button>
                </div>
            </div>

            <div class="info-panel">
                <div class="info-item"><strong>Total Momentum</strong> <span id="totalMomentum">0 kg·m/s</span></div>
                <div class="info-item"><strong>Kinetic Energy</strong> <span id="totalKE">0 J</span></div>
            </div>

            <canvas id="collisionCanvas"></canvas>

            <section id="notesSection" class="notes-section">
                <div class="notes-header">
                    <h3 data-lang-key="notesTitle">Momentum & Collisions</h3>
                    <button id="langToggleButton" class="lang-button">தமிழ்</button>
                </div>
                <div class="notes-content">
                    <div class="note-block">
                        <h4 data-lang-key="momentumTitle">Momentum</h4>
                        <p data-lang-key="momentumDesc">Momentum is the "quantity of motion" an object has. It is the
                            product of mass and velocity. In a closed system, total momentum is always conserved during
                            a collision.</p>
                    </div>
                    <div class="note-block">
                        <h4 data-lang-key="elasticityTitle">Coefficient of Restitution (e)</h4>
                        <p data-lang-key="elasticityDesc">This value (0 to 1) describes how elastic a collision is.
                            <code>e=1</code> means perfectly elastic (KE is conserved), while <code>e=0</code> means
                            perfectly inelastic (objects stick together).</p>
                    </div>
                    <div class="note-block">
                        <h4 data-lang-key="equationsTitle">Key Equations</h4>
                        <ul>
                            <li data-lang-key="eqMomentum">Momentum: <code>p = m × v</code></li>
                            <li data-lang-key="eqConservation">Conservation: <code>m₁u₁ + m₂u₂ = m₁v₁ + m₂v₂</code></li>
                            <li data-lang-key="eqElasticity">Elasticity: <code>e = (v₂ - v₁) / (u₁ - u₂)</code></li>
                        </ul>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <footer class="site-footer">
        <div class="container">
            <p>&copy; <span id="currentYear"></span> p6sims. Built by Hai.</p>
        </div>
    </footer>

    <script>
        document.getElementById('currentYear').textContent = new Date().getFullYear();

        const canvas = document.getElementById('collisionCanvas');
        const ctx = canvas.getContext('2d');
        const massASlider = document.getElementById('massA');
        const velASlider = document.getElementById('velA');
        const massBSlider = document.getElementById('massB');
        const velBSlider = document.getElementById('velB');
        const elasticitySlider = document.getElementById('elasticity');
        const startButton = document.getElementById('startButton');
        const resetButton = document.getElementById('resetButton');

        const totalMomentumSpan = document.getElementById('totalMomentum');
        const totalKESpan = document.getElementById('totalKE');

        let objA, objB, elasticity;
        let isRunning = false;
        let lastTimestamp = 0;

        const SCALE = 20; // pixels per kg
        const GROUND_Y = 250;

        function init() {
            const mA = parseFloat(massASlider.value);
            const vA = parseFloat(velASlider.value);
            const mB = parseFloat(massBSlider.value);
            const vB = parseFloat(velBSlider.value);
            elasticity = parseFloat(elasticitySlider.value);

            document.getElementById('massAValue').textContent = mA + ' kg';
            document.getElementById('velAValue').textContent = vA + ' m/s';
            document.getElementById('massBValue').textContent = mB + ' kg';
            document.getElementById('velBValue').textContent = vB + ' m/s';
            document.getElementById('elasticityValue').textContent = elasticity.toFixed(1);

            objA = { x: 100, m: mA, v: vA, color: '#3b82f6', size: mA * 10 + 20 };
            objB = { x: canvas.width - 200, m: mB, v: vB, color: '#ef4444', size: mB * 10 + 20 };

            updateStats();
            draw();
        }

        function updateStats() {
            const p = objA.m * objA.v + objB.m * objB.v;
            const ke = 0.5 * objA.m * objA.v ** 2 + 0.5 * objB.m * objB.v ** 2;
            totalMomentumSpan.textContent = p.toFixed(1) + ' kg·m/s';
            totalKESpan.textContent = ke.toFixed(1) + ' J';
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Ground
            ctx.fillStyle = '#f1f5f9';
            ctx.fillRect(0, GROUND_Y, canvas.width, 2);

            // Objects
            [objA, objB].forEach(obj => {
                ctx.fillStyle = obj.color;
                ctx.fillRect(obj.x - obj.size / 2, GROUND_Y - obj.size, obj.size, obj.size);
                ctx.strokeStyle = '#000';
                ctx.strokeRect(obj.x - obj.size / 2, GROUND_Y - obj.size, obj.size, obj.size);

                // Labels
                ctx.fillStyle = '#000';
                ctx.font = '12px Outfit';
                ctx.textAlign = 'center';
                ctx.fillText(obj.m + 'kg', obj.x, GROUND_Y - obj.size - 5);
                ctx.fillText(obj.v.toFixed(1) + 'm/s', obj.x, GROUND_Y - obj.size / 2 + 5);

                // Velocity arrow
                if (Math.abs(obj.v) > 0.1) {
                    drawArrow(obj.x, GROUND_Y - obj.size - 25, obj.x + obj.v * 10, GROUND_Y - obj.size - 25, obj.color);
                }
            });
        }

        function drawArrow(fx, fy, tx, ty, color) {
            const head = 7;
            const angle = Math.atan2(ty - fy, tx - fx);
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(fx, fy);
            ctx.lineTo(tx, ty);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(tx, ty);
            ctx.lineTo(tx - head * Math.cos(angle - Math.PI / 6), ty - head * Math.sin(angle - Math.PI / 6));
            ctx.lineTo(tx - head * Math.cos(angle + Math.PI / 6), ty - head * Math.sin(angle + Math.PI / 6));
            ctx.closePath();
            ctx.fillStyle = color;
            ctx.fill();
        }

        function animate(timestamp) {
            if (!isRunning) return;
            const dt = (timestamp - lastTimestamp) / 1000;
            lastTimestamp = timestamp;

            objA.x += objA.v * dt * 50; // Visual scale
            objB.x += objB.v * dt * 50;

            // Collision detection
            const distance = Math.abs(objA.x - objB.x);
            const minDistance = (objA.size + objB.size) / 2;

            if (distance <= minDistance) {
                // Physics of 1D Collision
                const u1 = objA.v;
                const u2 = objB.v;
                const m1 = objA.m;
                const m2 = objB.m;
                const e = elasticity;

                // v1 = (m1 - e*m2)*u1 + (m2 + e*m2)*u2 / (m1+m2)
                objA.v = ((m1 - e * m2) * u1 + (m2 + e * m2) * u2) / (m1 + m2);
                objB.v = ((m1 + e * m1) * u1 + (m2 - e * m1) * u2) / (m1 + m2);

                // Separate objects to prevent sticking
                const overlap = minDistance - distance;
                objA.x -= overlap / 2 * Math.sign(objB.x - objA.x);
                objB.x += overlap / 2 * Math.sign(objB.x - objA.x);
            }

            // Boundary checks
            if (objA.x < 0 || objA.x > canvas.width) objA.v *= -1;
            if (objB.x < 0 || objB.x > canvas.width) objB.v *= -1;

            updateStats();
            draw();
            requestAnimationFrame(animate);
        }

        startButton.onclick = () => {
            if (isRunning) {
                isRunning = false;
                startButton.textContent = 'Start';
            } else {
                isRunning = true;
                startButton.textContent = 'Pause';
                lastTimestamp = performance.now();
                requestAnimationFrame(animate);
            }
        };

        resetButton.onclick = () => {
            isRunning = false;
            startButton.textContent = 'Start';
            init();
        };

        [massASlider, velASlider, massBSlider, velBSlider, elasticitySlider].forEach(s => s.oninput = init);

        // Language Switching
        const languageData = {
            notesTitle: { en: "Momentum & Collisions", ta: "உந்தம் & மோதல்கள்" },
            momentumTitle: { en: "Momentum", ta: "உந்தம்" },
            momentumDesc: { en: "Momentum is the 'quantity of motion' an object has. It is the product of mass and velocity. In a closed system, total momentum is always conserved during a collision.", ta: "உந்தம் என்பது ஒரு பொருள் கொண்டிருக்கும் 'இயக்கத்தின் அளவு'. இது நிறை மற்றும் திசைவேகத்தின் பெருக்கற்பலன் ஆகும். ஒரு மூடிய அமைப்பில், மொத்த உந்தம் எப்போதும் மோதலின் போது பாதுகாக்கப்படுகிறது." },
            elasticityTitle: { en: "Coefficient of Restitution (e)", ta: "மீட்சிக் குணகம் (e)" },
            elasticityDesc: { en: "This value (0 to 1) describes how elastic a collision is. e=1 means perfectly elastic (KE is conserved), while e=0 means perfectly inelastic (objects stick together).", ta: "இந்த மதிப்பு (0 முதல் 1 வரை) ஒரு மோதல் எவ்வளவு மீள்தன்மை கொண்டது என்பதை விவரிக்கிறது. e=1 என்பது முற்றிலும் மீள்தன்மை கொண்டது (KE பாதுகாக்கப்படுகிறது), அதேசமயம் e=0 என்பது முற்றிலும் மீள்தன்மையற்றது (பொருட்கள் ஒன்றாக ஒட்டிக்கொள்கின்றன)." },
            equationsTitle: { en: "Key Equations", ta: "முக்கிய சமன்பாடுகள்" }
        };

        let currentLang = 'en';
        document.getElementById('langToggleButton').onclick = () => {
            currentLang = currentLang === 'en' ? 'ta' : 'en';
            document.getElementById('langToggleButton').textContent = currentLang === 'en' ? 'தமிழ்' : 'English';
            document.querySelectorAll('[data-lang-key]').forEach(el => {
                const key = el.getAttribute('data-lang-key');
                if (languageData[key]) el.textContent = languageData[key][currentLang];
            });
        };

        const notesHeader = document.querySelector('.notes-header');
        notesHeader.onclick = (e) => {
            if (e.target.id !== 'langToggleButton') {
                document.getElementById('notesSection').classList.toggle('notes-open');
            }
        };

        window.onload = () => {
            canvas.width = canvas.offsetWidth;
            init();
        };
    </script>
</body>

</html>